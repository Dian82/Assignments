\documentclass[12pt,UTF8]{ctexart}
\usepackage{titling,setspace,caption}
\usepackage{enumerate,enumitem}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{listings}
\usepackage{comment}
\usepackage{float}
\usepackage{graphicx}
\usepackage{multicol,multirow,bigstrut}
\usepackage{fancyhdr} % 页眉
\usepackage{rotating}
\usepackage{ctex,titlesec}
\usepackage[export]{adjustbox} % 图片左对齐
\usepackage[unicode=true,%本行非常重要 支持中文目录hyperref CJKbookmarks对二级目录没用
	colorlinks,
	linkcolor=black,
	anchorcolor=black,
	citecolor=black,
	CJKbookmarks=false]{hyperref}
\usepackage{xcolor}
\usepackage{geometry}
\geometry{top=25.4mm,bottom=25.4mm,left=31.8mm,right=31.8mm}
\pagestyle{plain}%删除页眉
\CTEXsetup[format={\large\bfseries}]{section}
\renewcommand\maketitlehooka{\null\mbox{}\vfill} % 标题页
\renewcommand\maketitlehookd{\vfill\null}

\newcommand{\chuhao}{\fontsize{42.2pt}{\baselineskip}\selectfont}
\newcommand{\xiaochu}{\fontsize{36.1pt}{\baselineskip}\selectfont}
\newcommand{\yihao}{\fontsize{26.1pt}{\baselineskip}\selectfont}
\newcommand{\xiaoyi}{\fontsize{24.1pt}{\baselineskip}\selectfont}
\newcommand{\erhao}{\fontsize{22.1pt}{\baselineskip}\selectfont}
\newcommand{\xiaoer}{\fontsize{18.1pt}{\baselineskip}\selectfont}
\newcommand{\sanhao}{\fontsize{16.1pt}{\baselineskip}\selectfont}
\newcommand{\xiaosan}{\fontsize{15.1pt}{\baselineskip}\selectfont}
\newcommand{\sihao}{\fontsize{14.1pt}{\baselineskip}\selectfont}
\newcommand{\xiaosi}{\fontsize{12.1pt}{\baselineskip}\selectfont}
\newcommand{\wuhao}{\fontsize{10.5pt}{\baselineskip}\selectfont}
\newcommand{\xiaowu}{\fontsize{9.0pt}{\baselineskip}\selectfont}
\newcommand{\liuhao}{\fontsize{7.5pt}{\baselineskip}\selectfont}
\newcommand{\xiaoliu}{\fontsize{6.5pt}{\baselineskip}\selectfont}
\newcommand{\qihao}{\fontsize{5.5pt}{\baselineskip}\selectfont}
\newcommand{\bahao}{\fontsize{5.0pt}{\baselineskip}\selectfont}
\titleformat{\section}{\xiaosi\bfseries}{\chinese{section}、 }{0em}{}
\titleformat{\subsection}{\wuhao\bfseries}{\Roman{subsection}. }{0em}{} %\arabic
\titleformat{\subsubsection}{\wuhao\bfseries}{\roman{subsubsection}. }{0em}{}
% \titlespacing*{hcommandi}{hlefti}{hbefore-sepi}{hafter-sepi}[hright-sepi]
\titlespacing*{\section}{0pt}{0pt}{3pt}
\titlespacing*{\subsection}{0pt}{0pt}{0pt}
\titlespacing*{\subsubsection}{0pt}{0pt}{0pt}
\captionsetup[figure]{font=small}
\captionsetup[table]{font=small}

\setenumerate[1]{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=5pt}
\setitemize[1]{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=5pt}

\lstset{
	language=Verilog,
	basicstyle=\tiny\ttfamily,
	escapechar={`,\&},
	showstringspaces=false,
	numbers=left,
	numberstyle=\bahao\ttfamily,
	numbersep=9pt,
	tabsize=4,
	breaklines=true,
	showtabs=false,
	frame=leftline,
	literate={\$}{{\textcolor{blue}{\$}}}1
}
\setlength{\droptitle}{-100pt}%减少标题与页眉距离

\title{
\includegraphics[width=0.2\linewidth,left]{../../SYSU.png}~\\[1cm]
\textbf{\yihao 《计算机组成原理实验》\\\chuhao实验报告\\\quad\\\xiaoyi（实验二）}
}

\vspace{100pt}

\author{}
\date{}

\newcommand{\myuline}[1]{\begin{tabular}{c}#1\\\hline\end{tabular}}

\begin{document}

\clearpage\maketitle
\thispagestyle{empty}

\vspace{100pt}
\begin{spacing}{1.5}
\xiaoer
\begin{center}
\begin{tabular}{rc}
\makebox[6.2em][s]{\textbf{学\hspace{\fill}院\hspace{\fill}名\hspace{\fill}称}} ： & 数据科学与计算机学院\\
\cline{2-2}\makebox[6.2em][s]{\textbf{专业（班级）}} ： & 17级计科教务一班\\
\cline{2-2}\makebox[6.2em][s]{\textbf{学\hspace{\fill}生\hspace{\fill}姓\hspace{\fill}名}} ：& 陈鸿峥\\
\cline{2-2}\makebox[6.2em][s]{\textbf{学\hspace{\fill}号}} ： & 17341015\\
\cline{2-2}\makebox[6.2em][s]{\textbf{时\hspace{\fill}间}} ： & 2018 年 11 月 12 日\\
\cline{2-2}
\end{tabular}
\end{center}
\end{spacing}

\newpage
\pagestyle{fancy}
\lhead{}
\rhead{\xiaowu\color{gray}{计算机组成原理实验}}
\setcounter{page}{1}
\quad\bigskip\bigskip
\rightline{\erhao\textbf{\underline{成绩：\qquad\quad}}}
\vspace{20pt}
\leftline{\erhao\textbf{\underline{实验二：单周期CPU设计与实现}}}
\vspace{-20pt}

\begin{spacing}{1.1}
\wuhao
\section{实验目的}
\begin{enumerate}
	\item 掌握单周期CPU数据通路图的构成、原理及其设计方法
	\item 掌握单周期CPU的实现方法，代码实现方法
	\item 认识和掌握指令与CPU的关系
	\item 掌握测试单周期CPU的方法
\end{enumerate}


\section{实验内容}
% 实验的具体内容与要求
\qquad设计一个单周期CPU，使其至少能实现以下指令功能操作。指令与格式如下：
% Table generated by Excel2LaTeX from sheet 'Instruction'
\begin{table}[htbp]
  \centering\liuhao
  \caption{基本MIPS指令及其格式}
    \begin{tabular}{|c|l|l|l|l|l|l|l|}
    \hline
          & \multicolumn{1}{c|}{指令} & \multicolumn{1}{c|}{功能} & \multicolumn{1}{c|}{op} & \multicolumn{1}{c|}{rs} & \multicolumn{1}{c|}{rt} & \multicolumn{1}{c|}{rd} & \multicolumn{1}{c|}{sham/func} \\
    \hline
    \multirow{3}[6]{*}{算术运算} & add rd, rs, rt & \verb'rd' $\gets$ \verb'rs + rt' & 000000 & rs(5位) & rt(5位) & rd(5位) & reserved \\
\cline{2-8}          & sub rd, rs, rt & \verb'rd' $\gets$ \verb'rs - rt' & 000001 & rs(5位) & rt(5位) & rd(5位) & reserved \\
\cline{2-8}          & addiu rt, rs, imm & \verb'rt' $\gets$ \verb'rs + SignExt(imm)' & 000010 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
    \hline
    \multirow{4}[8]{*}{逻辑运算} & andi rt, rs, imm & \verb'rt' $\gets$ \verb'rs & ZeroExt(imm)' & 010000 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
\cline{2-8}          & and rd, rs, rt & \verb'rd' $\gets$ \verb'rs & rt' & 010001 & rs(5位) & rt(5位) & rd(5位) & reserved \\
\cline{2-8}          & ori rt, rs, imm & \verb'rt' $\gets$ \verb'rs | ZeroExt(imm)' & 010010 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
\cline{2-8}          & or rd, rs, rt & \verb'rd' $\gets$ \verb'rs | rt' & 010011 & rs(5位) & rt(5位) & rd(5位) & reserved \\
    \hline
    移位    & sll rd, rt, sa & \verb'rd' $\gets$ \verb'rt<<ZeroExt(sa)' & 011000 & reserved    & rt(5位) & rd(5位) & sa(5位) \\
    \hline
    比较    & slti rt, rs, imm & \verb'rs<SignExt(imm) ? rt=1 : rt=0' & 011100 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
    \hline
    \multirow{2}[4]{*}{访存} & sw rt, imm(rs) & \verb'mem[rs+SignExt(imm)]' $\gets$ \verb'rt' & 100110 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
\cline{2-8}          & lw rt, imm(rs) & \verb'rt' $\gets$ \verb'mem[rs+\text{SignExt}(imm)]' &100111 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
    \hline
    \multirow{3}[6]{*}{分支} & beq rs, rt, imm & \begin{tabular}{l}\quad\verb'rs==rt'\\\verb'? pc+4+SignExt(imm)<<2'\\\verb': pc+4'\end{tabular} & 110000 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
\cline{2-8}          & bne rs, rt, imm & \begin{tabular}{l}\quad\verb'rs!=rt'\\\verb'? pc+4+SignExt(imm)<<2'\\\verb': pc+4'\end{tabular} & 110001 & rs(5位) & rt(5位) & \multicolumn{2}{c|}{imm16} \\
\cline{2-8}          & bltz rs, imm & \begin{tabular}{l}\quad\verb'rs<'\$\verb'0'\\\verb'? pc+4+SignExt(imm)<<2'\\\verb': pc+4'\end{tabular} & 110010 & rs(5位) & 00000 & \multicolumn{2}{c|}{imm16} \\
    \hline
    跳转    & j addr & \verb'pc' $\gets$ $\{$\verb'(pc+4)[31:28],addr[27:2],2'$'$\verb'b00'$\}$ & 111000 & \multicolumn{4}{c|}{addr[27:2]} \\
    \hline
    停机    & halt  & halt & 111111 & \multicolumn{4}{l|}{00000000000000000000000000(26位)} \\
    \hline
    \end{tabular}%
  \label{tab:instructions}%
\end{table}%
\par 注意：reserved为预留部分，一般用0填充

\section{实验器材}
\qquad电脑一台、Xilinx Vivado软件一套、Basys3板一块

\section{实验原理}
% 说明：根据需要书写相关内容，如：CPU是怎么设计的？如何验证所设计的CPU是正确的？讲清楚这两个问题。
% 1、CPU设计的思想、方法：流程图，控制信号表的作用，如何应用？相关图（模块）的说明，及其相关实现代码说明（代码部分必须有侧重点，无需太泛！），强调关键部分，必须有文字加以说明。
% 2、如何验证你设计的CPU正确性？截波形图说明。波形图上必须包含与该条指令相关的、能说明该指令正确的信号（控制信号、结果数据和地址等），还有结果存放的寄存器及内容，或数据存储器地址及内容，或顺序执行的地址，或即将转移的地址。必须说明相关信号及其作用。对设计中要求实现的每条指令都必须这么做。
% 3、实现。如何在Basys3板上运行所设计的CPU？必须在实验报告中说明设计的思想方法，操作方法。至少应该有连续5条指令以上，在板上运行的结果，拍照，贴图，来说明。

% 1、PC和寄存器组写状态使用时钟边缘触发。
% 2、指令存储器和数据存储器存储单元宽度一律使用8位，即一个字节的存储单位。不能使用32位作为存储器存储单元宽度。
% 3、控制器部分要学会用控制信号真值表方法分析问题并写出逻辑表达式；或者用case语句方法逐个产生各指令控制信号。
% 4、必须按统一测试用的汇编程序段进行测试所设计的CPU。
% 5、必须注意，实验报告中，对每条指令必须有指令执行的波形（截图），且图上必须包含关键信号，同时还要对关键信号以文字说明，这样才能说明该指令的正确性。

% 需要说明的是以上数据通路图是根据要实现的指令功能的要求画出来的，同时，还必须确定ALU的运算功能(当然，以上指令没有完全用到提供的ALU所有功能，但至少必须能实现以上指令功能操作)。从数据通路图上可以看出控制单元部分需要产生各种控制信号，当然，也有些信号必须要传送给控制单元。从指令功能要求和数据通路图的关系得出以上表1，这样，从表1可以看出各控制信号与相应指令之间的相互关系，根据这种关系就可以得出控制信号与指令之间的关系表（留给学生完成），再根据关系表可以写出各控制信号的逻辑表达式，这样控制单元部分就可实现了。
% 指令执行的结果总是在时钟下降沿保存到寄存器和存储器中，PC的改变是在时钟上升沿进行的，这样稳定性较好。另外，值得注意的问题，设计时，用模块化的思想方法设计，关于ALU设计、存储器设计、寄存器组设计等等，也是必须认真考虑的问题。

\input{basic_concepts}
\input{datapath}
\input{basic_components}
\input{control_unit}


\section{实验步骤}
\input{simulation}
\input{implementation}

\section{结果与分析}
\subsection{仿真模拟}

\subsection{上板}

\section{实验心得}
% 体会和建议。（必须认真写，若过于简单，扣分！）
% (所写内容，如实验的整个过程中，所碰到的问题、所思考的问题等，以及最后如何获得解决，从中得到什么?等等，当然，还可能存在未解决的问题，或有所建议等。整个来说，就是总结一下本实验的情况，温故而知新，这个道理显而易见。)
\begin{enumerate}
	\item 
\end{enumerate}

\input{appendix}

\end{spacing}

\end{document}