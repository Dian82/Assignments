# Week 06 - 目标检测与实例分割

## 定义
* 目标检测
	* 分类定位物体实例
* 实例分割
	* 语义分割每一实例
* 应用
	* 监视
	* 自动驾驶
	* 医学影像
* 子任务
	* 物体在哪
		* 边界框(bounding box)
		* 位置、大小
	* 物体的类别
		* 将边界框送给分类器

## 两阶段
### R-CNN [IJCV'13]
* 阶段一：确定边界框
	* 选择性搜索
		* 基于层次分组
	* 猜边界框
	* 微调
		* 回归器t_i=r(x_i;\theta)
			* 预测与真实(GT)的相对偏差t_i
		* (x_i,y_i,w_i,h_i)坐标大小编码
		* 输出对坐标归一化(x\*-x)/w，对大小取log(w\*/w)
			* 使得边界框大小恒定
			* 预测值不局限于正值
		* 损失：Lp距离度量
* 阶段二：分类
	* K个物体类，1个背景类
	* 预处理
		* 将训练数据打包成方块
	* 交叉熵损失
* 分类器+回归器
	* 一起训练
	* 输出全连接层
		* 前一半为分类器
		* 后一半为回归器
* 推理
	* 生成2k边界框，分类
	* 非极大值抑制(NMS)移除边界框
		* 大量冗余边界框
		* 搜寻最优bbox

### Fast R-CNN [ICCV'15]
* 挑战
	* RCNN
		* 单一CNN应用多次，一次一bbox
		* 推理极慢
* 架构
	* 在最后一层卷积层才应用bbox（RoI池化）
	* 特征提取只用一次CNN
	* RoI池化
		![](fig/roi_layer.jpg)
		* 将每一RoI映射到S\*S的区域
		* 这些输出与全连接层相连
		* 前半分类器+后半回归器
* Faster R-CNN [NIPS'15]
	* Region Proposal Network (RPN)
		* 从feature map引一条路径接RPN
		* 预测bbox proposals
			* 与GT边界框做回归
		* 快速推断（比选择性搜索快得多）
	* Anchors
		![](fig/anchors.jpg)
		* 9个矩形
		* 用以定位边界框
	* 用ImageNet做预训练
* 问题
	* 小的物体无法被最后一层卷积识别

### FPN [CVPR'17]
* 核心
	* 利用**多尺度**特征
* 上采样
	* 空间稀疏但语义更强
	* 嵌入语义到低层
	* 类似U-Net做跳连
* 可被用于不同网络结构

### Mask-RCNN
* Faster R-CNN + FCN
* 损失函数
	* L = L_c + L_r + L_s
* 亮点
	* 解耦分割和分类任务
		* 每个像素只属于一个类
	* RolAlign
		* 双线性插值
* 架构
	* 骨架
		* ResNet或FPN的前4个Conv
	* 头部
		* 分类器
		* 回归器
		* 分割

## 一阶段
* 同时生成类别和边界框
* 快（实时）但精度低
	* 物体前景和背景样本量不均
	* 解决方案：Focal Loss
		* 降训练得很好的样本的权重
		* 训练更侧重训练得不好的样本

### YOLO [CVPR'16]
* 将输入转换为S\*S个格
* 每个格预测B个框&置信度，C类别概率
* 物体中心落在格中，则该格预测该物体
* 每个类
	* 非极大值抑制
* 不能预测成群小物体

### SSD [ECCV'16]
* 从多个卷积层输出开始预测
	* 多尺度！
* 最末非极大值抑制
* 正边界框才会被送入训练
	* 与GT重合度高
	* 背景为负
* 推断比YOLO更快，精度更高

### RetinaNet [ICCV'17]
* ResNet + FPN + 2FCNs
	* 分类器用focal loss
	* 回归器同RPN
* 每层有默认anchor box
* 同RPN和SSD生成训练样本方式

### FCOS [ICCV'19]
* 多尺度映射
* 将每特征层每一像素都作为训练样本
	* 在GT内为正，否则为负
	* 算该像素到边界框四周距离进行回归
* center-ness loss
	* 给远离物体中心的bbox降权
* 无约束bbox
	* 避免冗余超参（大小、缩放尺度）